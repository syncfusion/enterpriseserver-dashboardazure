{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "SelectAppServiceNeedToDeploy": {
      "type": "string",
      "allowedValues": [
        "Dashboard Server",
        "User Management Server",
        "Dashboard Server with User Management Server"
      ],
      "metadata": {
        "description": "Select the Application that need to be deployed."
      }
    },
    "StorageType": {
      "type": "string",
      "allowedValues": [
        "FileStorage",
        "AzureBlobStorage"
      ],
      "metadata": {
        "description": "Choose a storage type for storing files the dashboard server generates. A complete list of files generated by the dashboard server can be viewed <a target='_blank' href='https://help.syncfusion.com/dashboard-platform/dashboard-server/faq#what-all-are-the-files-and-folders-will-be-generated-in-the-installed-machine'>here</a>."
      },
      "defaultValue": "FileStorage"
    },
    "AppServiceName": {
      "type": "string",
      "metadata": {
        "description": "Web App name for User Management Server/Dashboard Server. The name must be between 3 and 24 characters long, and can contain only numbers and lowercase letters."
      }
    },
    "BlobStorageName": {
      "maxLength": 24,
      "minLength": 3,
      "type": "string",
      "metadata": {
        "description": "Storage account name for storing files the Dashboard/User Management Server generates. The name must be between 3 to 24 characters long, and can contain only numbers and lowercase letters."
      },
      "defaultValue": "storageaccountname"
    },
    "BlobStorageAccountType": {
      "type": "string",
      "defaultValue": "Standard_LRS",
      "allowedValues": [
        "Standard_LRS",
        "Standard_ZRS",
        "Standard_GRS",
        "Standard_RAGRS",
        "Premium_LRS"
      ]
    }
  },
  "variables": {
    "AppServiceType": {
      "Dashboard Server": "DS",
      "User Management Server": "UMS",
      "Dashboard Server with User Management Server": "DS-UMS"
    },
    "SelectAppServiceNeedToDeploy": "[variables('AppServiceType')[parameters('SelectAppServiceNeedToDeploy')]]",
    "templatelink": "[concat('https://raw.githubusercontent.com/syncfusion/enterpriseserver-dashboardazure/master/armtemplates/v3.2.0.69/',parameters('StorageType'),'.json')]",
    "dsGithubUrl": "https://github.com/syncfusion/enterpriseserver-dashboardazure.git",
    "umsGithubUrl": "https://github.com/SyncfusionInstall/enterpriseserver-umsazure.git",
    "dsReleaseVersion": "v3.2.0.69",
    "umsReleaseVersion": "v2.1.0.24",
    "appSvcPlanSkuName": "B1",
    "appSvcPlanName": "SyncfusionAppSvcPlan",
    "DS": {
      "alwaysOn": true,
      "netFrameworkVersion": "v4.6",
      "remoteDebuggingEnabled": false,
      "remoteDebuggingVersion": "VS2015",
      "use32BitWorkerProcess": true,
      "virtualApplications": [
        {
          "virtualPath": "/",
          "physicalPath": "site\\wwwroot"
        },
        {
          "virtualPath": "/API",
          "physicalPath": "site\\wwwroot\\API"
        },
		{
          "virtualPath": "/webdesignerservice",
          "physicalPath": "site\\wwwroot\\WebDesignerService"
        }
      ],
      "webSocketsEnabled": true
    },
    "UMS": {
      "alwaysOn": true,
      "netFrameworkVersion": "v4.6",
      "remoteDebuggingEnabled": false,
      "remoteDebuggingVersion": "VS2015",
      "use32BitWorkerProcess": true,
      "virtualApplications": [
        {
          "virtualPath": "/",
          "physicalPath": "site\\wwwroot"
        },
        {
          "virtualPath": "/API",
          "physicalPath": "site\\wwwroot\\API"
        }
      ],
      "webSocketsEnabled": true
    }
  },
  "resources": [
    {
      "apiVersion": "2015-01-01",
      "condition": "[or(equals(variables('SelectAppServiceNeedToDeploy'), 'DS'), equals(variables('SelectAppServiceNeedToDeploy'), 'UMS'))]",
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', variables('appSvcPlanName'))]"
      ],
      "name": "UMS-DS",
      "properties": {
        "mode": "Incremental",
        "parameters": {
          "AppServiceName": { "value": "[parameters('AppServiceName')]" },
          "AppServicePlanLocation": { "value": "[resourceGroup().location]" },
          "AppServicePlanResourceGroup": { "value": "[resourceGroup().name]" },
          "AppServiceType": { "value": "[variables('SelectAppServiceNeedToDeploy')]" },
          "BlobStorageAccountType": { "value": "[parameters('BlobStorageAccountType')]" },
          "BlobStorageName": { "value": "[parameters('BlobStorageName')]" },
          "deploySiteSettings": { "value": "[variables(variables('SelectAppServiceNeedToDeploy'))]" },
          "GithubURL": { "value": "[variables(concat(toLower(variables('SelectAppServiceNeedToDeploy')),'GithubUrl'))]" },
          "ReleaseVersion": { "value": "[variables(concat(toLower(variables('SelectAppServiceNeedToDeploy')),'ReleaseVersion'))]" },
          "StorageType": { "value": "[parameters('StorageType')]" }
        },
        "templateLink": {
          "uri": "[variables('templatelink')]",
          "contentVersion": "1.0.0.0"
        }
      },
      "type": "Microsoft.Resources/deployments"
    },
    {
      "apiVersion": "2015-01-01",
      "condition": "[equals(variables('SelectAppServiceNeedToDeploy'), 'DS-UMS')]",
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', variables('appSvcPlanName'))]"
      ],
      "name": "UMS",
      "properties": {
        "mode": "Incremental",
		"templateLink": {
          "uri": "[variables('templatelink')]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "AppServiceName": { "value": "[concat(parameters('AppServiceName'),'-ums')]" },
          "AppServicePlanLocation": { "value": "[resourceGroup().location]" },
          "AppServicePlanResourceGroup": { "value": "[resourceGroup().name]" },
          "AppServiceType": { "value": "UMS" },
          "BlobStorageAccountType": { "value": "[parameters('BlobStorageAccountType')]" },
          "BlobStorageName": { "value": "[parameters('BlobStorageName')]" },
          "deploySiteSettings": { "value": "[variables('UMS')]" },
          "GithubURL": { "value": "[variables('umsGithubUrl')]" },
          "ReleaseVersion": { "value": "[variables('umsReleaseVersion')]" },
          "StorageType": { "value": "[parameters('StorageType')]" }
        }
      },
      "type": "Microsoft.Resources/deployments"
    },
    {
      "apiVersion": "2015-01-01",
      "condition": "[equals(variables('SelectAppServiceNeedToDeploy'), 'DS-UMS')]",
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', variables('appSvcPlanName'))]"
      ],
      "name": "DS",
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[variables('templatelink')]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "AppServiceName": { "value": "[parameters('AppServiceName')]" },
          "AppServicePlanLocation": { "value": "[resourceGroup().location]" },
          "AppServicePlanResourceGroup": { "value": "[resourceGroup().name]" },
          "AppServiceType": { "value": "DS" },
          "BlobStorageAccountType": { "value": "[parameters('BlobStorageAccountType')]" },
          "BlobStorageName": { "value": "[parameters('BlobStorageName')]" },
          "deploySiteSettings": { "value": "[variables('DS')]" },
          "GithubURL": { "value": "[variables('dsGithubUrl')]" },
          "ReleaseVersion": { "value": "[variables('dsReleaseVersion')]" },
          "StorageType": { "value": "[parameters('StorageType')]" }
        }
      },
      "type": "Microsoft.Resources/deployments"
    },
    {
      "apiVersion": "2015-08-01",
      "dependsOn": [],
      "location": "[resourceGroup().location]",
      "name": "[variables('appSvcPlanName')]",
      "properties": {
        "name": "[variables('appSvcPlanName')]",
        "numberOfWorkers": 1
      },
      "sku": {
        "name": "[variables('appSvcPlanSkuName')]"
      },
      "tags": {
        "displayName": "SyncfusionAppServicePlan"
      },
      "type": "Microsoft.Web/serverfarms"
    }
  ]
}
