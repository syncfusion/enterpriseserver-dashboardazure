@{
    ViewBag.Title = GlobalAppSettings.SystemSettings.OrganizationName + " - [[[Users - Import from database]]]";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles{
    @Styles.Render("~/Styles/user-database-import")
}
@section scripts{
    @Scripts.Render("~/Scripts/user-database-import")
    <script>
        var testConnectionUrl = "@Url.Action("TestDatabaseConnection", "UserManagement")";
        var connectDatabaseUrl = "@Url.Action("ConnectDatabaseToImport", "UserManagement")";
        var getDatabaseUrl = "@Url.Action("GetDatabaseList", "UserManagement")";
        var getTableRelationUrl = "@Url.Action("GetTableRelation", "UserManagement")";
        var getResultDataUrl = "@Url.Action("GetDataForImportFromDatabase", "UserManagement")";
        var getSearchedResultUrl = "@Url.Action("GetDataWithSearchForImport", "UserManagement")";
        var saveSelectedUsersUrl = "@Url.Action("ImportSelectedUsersFromDatabase", "UserManagement")";
    </script>
}

@section MainSection{
    @Html.Partial("_UserMenu")
    @if (GlobalAppSettings.SystemSettings.ActivationType == ActivationType.EmailActivation && ViewBag.IsEmailSettingsConfigured)
    {
        <div id="import-database-container" class="container-fluid admin-page-container">
            <div class="col-md-12 import-area admin-page-header">
                <div class="col-xs-6 no-padding">
                    <a href="@Url.Action("index", "UserManagement")" data-toggle="tooltip" data-placement="top" title="[[[Users]]]" class="back-button pull-left">
                        <i class="su su-arrow-back"> </i>
                    </a>
                    <h1 class="page-title">
                        [[[IMPORT USERS FROM DATABASE]]]
                    </h1>
                </div>
                <div class="col-xs-6 page-btn-holder no-padding">
                    <div class="connection-properties-form">
                        <button type="button" id="connect-database" class="primary-button pull-right">[[[Connect]]]</button>
                    </div>
                    <button type="button" id="apply-connections" class="primary-button pull-right display-none" disabled="disabled">[[[Next]]]</button>
                    <button type="button" id="import-selected" class="primary-button pull-right display-none" onclick="SaveSelectedUsers()">[[[Import users]]]</button>
                </div>
            </div>
            <div class="col-lg-12 connection-properties-form admin-page-body">
                <div id="connect-properties" class="col-md-5 col-sm-6 col-xs-12">
                    <form class="col-xs-12 no-padding form-horizontal">
                        <div class="form-group">
                            <div id="databasetype-holder" class="col-xs-12 no-padding">
                                <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                    [[[Database type]]]
                                </label>
                                <div class="col-xs-8 connect-database-padding txt-holder">
                                    <select id="database-type" class="selectpicker">
                                        <option value="MSSQL">[[[SQL Server]]]</option>
                                        @if (ViewBag.StorageType != (int)StorageType.AzureBlob)
                                        {
                                            <option value="ORACLE">[[[Oracle]]]</option>
                                            <option value="MYSQL">[[[MySQL]]]</option>
                                        }
                                        <option value="PostgreSQL">[[[PostgreSQL]]]</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                    <form id="sql-content-holder" class="col-xs-12 no-padding content-display show-sql-content form-horizontal">
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Server name]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" id="txt-servername" name="servername" class="form-control" placeholder="[[[Server name]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Authentication]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <select id="check-windows" class="selectpicker">
                                    <option value="sql">[[[SQL Authentication]]]</option>
                                    <option value="windows">[[[Windows Authentication]]]</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Username]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" id="txt-login" name="username" class="form-control" placeholder="[[[Username]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Password]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" style="display: none;">
                                <input type="password" id="txt-password-db" name="password" class="form-control" placeholder="[[[Password]]]" autocomplete="off" />
                                <span id="password-field" class="validation-txt-errors"></span>
                                <div class="su su-eye show-hide-password"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Database name]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <select id="txt-dbname" class="selectpicker database-name-select" title="[[[Database name]]]" data-size="5"></select>
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                    </form>
                    <form id="mysql-content-holder" class="col-xs-12 no-padding content-display show-mysql-content display-none form-horizontal">
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[MySQL ODBC DSN]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <select id="mysql-odbc-dsn" name="mySqlDsn" class="selectpicker" data-size="5">
                                    <option value="" class="display-none">[[[Select MySQL ODBC DSN]]]</option>
                                    @for (var dsn = 0; dsn < ViewBag.DsnList.Count; dsn++)
                                    {
                                        <option value="@ViewBag.DsnList[dsn]">@ViewBag.DsnList[dsn]</option>
                                    }
                                </select>
                                <span id="dsn-validate" class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Username]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" id="mysql-username" name="mySqlUserName" class="form-control" placeholder="[[[Username]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Password]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" style="display: none;">
                                <input type="password" id="mysql-password" name="mysqlPassword" class="form-control system-settings-startup-page-fields db-fields" placeholder="[[[Password]]]" autocomplete="off" />
                                <span id="password-field" class="validation-txt-errors"></span>
                                <div class="su su-eye show-hide-password"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Database name]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <select id="mysql-txt-dbname" class="selectpicker database-name-select" title="[[[Database name]]]" data-size="5"></select>
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                    </form>
                    <form id="oracle-content-holder" class="col-xs-12 no-padding content-display show-oracle-content display-none form-horizontal">
                        <div class="form-group">
                            <label class="col-xs-5 connect-database-padding txt-holder app-textbox-label">
                                [[[Oracle ODBC DSN]]]
                            </label>
                            <div class="col-xs-7 connect-database-padding txt-holder">
                                <select id="oracle-dsn" name="oracleDsn" class="selectpicker" data-size="5">
                                    <option value="" class="display-none">[[[Select Oracle ODBC DSN]]]</option>
                                    @for (var dsn = 0; dsn < ViewBag.DsnList.Count; dsn++)
                                    {
                                        <option value="@ViewBag.DsnList[dsn]">@ViewBag.DsnList[dsn]</option>
                                    }
                                </select>
                                <span id="oracle-dsn-validate" class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-5 connect-database-padding txt-holder app-textbox-label">
                                [[[Admin username]]]
                            </label>
                            <div class="col-xs-7 connect-database-padding txt-holder">
                                <input type="text" id="admin-username" name="adminUserName" class="form-control" placeholder="[[[Admin Username]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-5 connect-database-padding txt-holder app-textbox-label">
                                [[[Admin password]]]
                            </label>
                            <div class="col-xs-7 connect-database-padding txt-holder">
                                <input type="text" style="display: none;">
                                <input type="password" id="admin-password" name="adminPassword" class="form-control" placeholder="[[[Admin Password]]]" autocomplete="off" />
                                <span id="admin-password-field" class="validation-txt-errors password-field"></span>
                                <div class="su su-eye show-hide-password"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-5 connect-database-padding txt-holder app-textbox-label">
                                [[[Database name]]]/[[[Username]]]
                            </label>
                            <div class="col-xs-7 connect-database-padding txt-holder">
                                <select id="client-username" class="selectpicker database-name-select" title="[[[Database Name/Username]]]" data-size="5"></select>
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-5 connect-database-padding txt-holder app-textbox-label">
                                [[[Database password]]]
                            </label>
                            <div class="col-xs-7 connect-database-padding txt-holder">
                                <input type="text" style="display: none;">
                                <input type="password" id="client-password" name="clientPassword" class="form-control" placeholder="[[[Database Password]]]" autocomplete="off" />
                                <span id="client-password-field" class="validation-txt-errors password-field"></span>
                                <div class="su su-eye show-hide-password"></div>
                            </div>
                        </div>
                    </form>
                    <form id="postgresql-content-holder" class="col-xs-12 no-padding content-display show-postgresql-content display-none form-horizontal">
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Server name]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" id="postgresql-servername" name="servername" class="form-control" placeholder="[[[Server name]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Port]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" id="postgresql-port" name="port" class="form-control" placeholder="[[[Port]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Username]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" id="postgresql-login" name="username" class="form-control" placeholder="[[[Username]]]" />
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Password]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <input type="text" style="display: none;">
                                <input type="password" id="postgresql-password-db" name="password" class="form-control" placeholder="[[[Password]]]" autocomplete="off" />
                                <span id="password-field" class="validation-txt-errors"></span>
                                <div class="su su-eye show-hide-password"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4 connect-database-padding txt-holder app-textbox-label">
                                [[[Database name]]]
                            </label>
                            <div class="col-xs-8 connect-database-padding txt-holder">
                                <select id="postgresql-dbname" class="selectpicker database-name-select" title="[[[Database name]]]" data-size="5"></select>
                                <span class="validation-txt-errors"></span>
                            </div>
                        </div>
                    </form>
                    <button type="button" id="test-connection" class="primary-button  pull-right">[[[Test Connection]]]</button>
                </div>
                <div class="col-xs-12 connection-properties-form">
                    <div class="col-md-5 col-sm-6 col-xs-12 text-center">
                        <span id="test-connection-validation"></span>
                    </div>
                </div>
            </div>
            <div id="selected-schema-container" class="col-xs-12 selected-schema-container display-none admin-page-body">
            </div>
        </div>
        <div id="select-existing-join">
            <div class="col-xs-12 no-padding">
                <div class="col-xs-12 no-padding">
                    <h3>[[[Select Relation]]]</h3>
                </div>
                <div class="col-xs-12 no-padding table-content">
                    <table class="relation-list"></table>
                </div>
            </div>
            <div class="col-xs-12 btn-relation-holder">
                <button type="button" id="select-relation" class="primary-button pull-right">[[[Apply]]]</button>
            </div>
        </div>

        <div id="get-join-details">
            <div class="col-xs-12 no-padding">
                <div class="col-xs-12 no-padding">
                    <span class="join-dialog-title">[[[Form Relation]]]</span>
                </div>
                <div class="col-xs-12 no-padding relation-select-content">
                    <div class="col-xs-5 no-padding">
                        <h5>[[[Left table]]]</h5>
                        <div class="col-xs-12 no-padding">
                            <select id="left-table-selection" class="selectpicker"></select>
                        </div>
                        <div id="left-table-columnlist" class="col-xs-12 no-padding column-list">
                            <ul></ul>
                        </div>
                    </div>
                    <div class="col-xs-2 no-padding">
                        <div id="join-type-holder">
                            <select id="join-type" class="selectpicker">
                                <option value="inner join">[[[Inner Join]]]</option>
                                <option value="left join">[[[Left Join]]]</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-xs-5 no-padding">
                        <h5>[[[Right table]]]</h5>
                        <div class="col-xs-12 no-padding">
                            <select id="right-table-selection" class="selectpicker" disabled="disabled"></select>
                        </div>
                        <div id="right-table-columnlist" class="col-xs-12 no-padding column-list">
                            <ul></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 btn-relation-holder">
                <button type="button" id="apply-relation" class="primary-button pull-right" disabled="disabled">[[[Apply]]]</button>
            </div>
        </div>
    }
    else
    {
        <div id="import-database-container" class="container-fluid admin-page-container">
            <div class="col-md-12 import-area admin-page-header">
                <div class="col-xs-6 no-padding">
                    <a href="@Url.Action("index", "UserManagement")" title="[[[Import Users]]]" class="back-button pull-left">
                        <i class="su su-arrow-back back-navigaion"> </i>
                    </a>
                    <h1 class="page-title">
                        [[[IMPORT USERS FROM DATABASE]]]
                    </h1>
                </div>
            </div>
            <div class="col-md-12 admin-page-body">
                @if (GlobalAppSettings.SystemSettings.ActivationType != ActivationType.EmailActivation)
                {
                    <h5>[[[Importing users from existing database is not available in automatic account activation type.]]]</h5>
                    <a href="@Url.Action("user-settings", "administration")" class="admin-page-link">[[[Please click here to change the account activation type]]]</a>
                }
                else if (!ViewBag.IsEmailSettingsConfigured)
                {
                    <a href="@Url.Action("e-mail-settings", "administration")" class="admin-page-link">[[[Please click here to configure the Email settings]]]</a>
                }
            </div>
        </div>
    }
}